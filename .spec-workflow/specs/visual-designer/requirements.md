# 可视化测试设计器 需求规格说明书

## 1. 引言

本功能旨在提供图形化的测试流程设计工具，用户通过拖拽节点、连接流程的方式创建测试用例，无需编写代码或 YAML。降低测试自动化的门槛，让非技术人员也能创建和维护测试。

## 2. 术语定义

* **画布 (Canvas)**: 测试流程的可视化编辑区域。
* **节点 (Node)**: 代表测试步骤的可视化元素。
* **连线 (Edge)**: 表示节点间执行顺序的连接线。
* **节点面板 (Node Panel)**: 可用节点类型的选择区域。
* **属性面板 (Property Panel)**: 编辑选中节点属性的区域。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 画布操作 (Canvas Operations)

* **系统** 必须 提供可缩放、可平移的无限画布。
* **系统** 必须 支持以下画布操作：
  - 鼠标拖拽平移
  - 滚轮/手势缩放
  - 框选多个节点
  - 快捷键操作（Ctrl+C/V/Z 等）

* **系统** 应 提供画布网格对齐功能。
* **系统** 应 支持画布小地图导航。

### 3.2 节点类型 (Node Types)

* **系统** 必须 支持以下节点类型：

  **3.2.1 动作节点**
  - 点击 (Click)
  - 输入 (Input)
  - 滚动 (Scroll)
  - 等待 (Wait)
  - 导航 (Navigate)
  - 悬停 (Hover)
  - 拖拽 (Drag)

  **3.2.2 验证节点**
  - 断言存在 (Assert Exists)
  - 断言文本 (Assert Text)
  - 断言状态 (Assert State)
  - AI 验证 (AI Assert)

  **3.2.3 控制节点**
  - 条件分支 (If/Else)
  - 循环 (Loop)
  - 并行 (Parallel)
  - 分组 (Group)

  **3.2.4 数据节点**
  - 变量设置 (Set Variable)
  - 数据提取 (Extract Data)
  - 外部数据 (External Data)

  **3.2.5 特殊节点**
  - 开始 (Start)
  - 结束 (End)
  - 注释 (Comment)
  - 子流程 (Sub-flow)

### 3.3 节点编辑 (Node Editing)

* **当** 用户从节点面板拖拽节点到画布时，**系统** 必须 在放置位置创建节点。
* **当** 用户双击节点时，**系统** 必须 打开属性面板编辑节点配置。
* **当** 用户选中节点按 Delete 键时，**系统** 必须 删除节点及其连线。
* **系统** 必须 支持节点复制/粘贴。

### 3.4 连线操作 (Edge Operations)

* **当** 用户从节点输出端口拖拽到另一节点输入端口时，**系统** 必须 创建连线。
* **系统** 应 自动避免连线交叉，提供智能路由。
* **系统** 必须 支持删除连线。
* **系统** 应 支持条件连线（根据条件选择分支）。

### 3.5 属性配置 (Property Configuration)

* **当** 选中动作节点时，**系统** 必须 展示以下配置项：
  - 目标元素描述（自然语言）
  - 输入值（如适用）
  - 超时设置
  - 失败处理策略

* **系统** 应 支持从页面直接选择元素填充目标描述。
* **系统** 应 支持变量引用（${variableName}）。

### 3.6 流程验证 (Flow Validation)

* **系统** 必须 实时验证流程的有效性：
  - 必须有开始和结束节点
  - 不能有孤立节点
  - 不能有循环依赖
  - 必要属性已填写

* **当** 存在验证错误时，**系统** 必须 在对应节点显示错误标记。

### 3.7 预览与执行 (Preview & Execution)

* **系统** 必须 支持将可视化流程转换为 YAML 脚本预览。
* **系统** 必须 支持直接从设计器启动执行。
* **当** 执行时，**系统** 应 在画布上实时高亮当前执行节点。

### 3.8 导入导出 (Import & Export)

* **系统** 必须 支持将设计保存为项目文件（JSON 格式）。
* **系统** 必须 支持导出为 Midscene YAML 格式。
* **系统** 应 支持从现有 YAML 脚本导入生成流程图。

### 3.9 模板与复用 (Templates & Reusability)

* **系统** 应 支持将流程片段保存为模板。
* **系统** 应 支持子流程引用，实现流程复用。
* **系统** 应 提供常用场景的预置模板（登录、搜索、表单提交等）。

---

## 4. 非功能需求 (Non-Functional Requirements)

### 4.1 性能 (Performance)

* **系统** 应 支持 200+ 节点的流程而不卡顿。
* **系统** 的节点拖拽响应延迟应 < 16ms（60fps）。

### 4.2 易用性 (Usability)

* **系统** 必须 提供撤销/重做功能（至少 50 步）。
* **系统** 应 支持键盘快捷键操作。
* **系统** 应 提供节点搜索功能。

### 4.3 兼容性 (Compatibility)

* **系统** 生成的 YAML 必须与现有 Midscene 执行引擎完全兼容。
* **系统** 应 支持主流浏览器（Chrome、Edge、Firefox）。

---

## 5. 限制与假设 (Constraints & Assumptions)

* **假设**: 用户理解基本的流程图概念。
* **限制**: 复杂的编程逻辑（循环变量、复杂表达式）可能需要手动编辑 YAML。
* **限制**: 实时执行预览需要页面处于可访问状态。
