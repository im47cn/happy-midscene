# 智能断言生成 需求规格说明书

## 1. 引言

本功能旨在降低测试用例编写门槛，通过 AI 分析操作上下文自动推荐合适的断言验证点。用户无需手动编写断言逻辑，系统将基于操作意图智能生成验证条件，提升测试覆盖率和可靠性。

## 2. 术语定义

* **断言 (Assertion)**: 测试中用于验证预期结果的逻辑判断语句。
* **验证点 (Checkpoint)**: 测试流程中需要进行结果验证的关键节点。
* **操作意图 (Action Intent)**: 用户执行某个操作的目的和预期效果。
* **断言模板 (Assertion Template)**: 预定义的断言模式，可复用于相似场景。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 断言时机识别 (Timing Recognition)

* **当** 测试步骤执行完成后，**系统** 应 自动分析该步骤是否需要添加断言验证。
* **系统** 必须 识别以下高价值断言时机：
  - 表单提交后
  - 页面导航后
  - 数据修改操作后
  - 状态切换操作后
  - 弹窗/提示出现后

* **当** 识别到断言时机时，**系统** 应 主动向用户推荐断言建议。

### 3.2 断言类型支持 (Assertion Types)

* **系统** 必须 支持以下断言类型：

  **3.2.1 存在性断言**
  - 元素是否存在/可见
  - 文本是否出现在页面
  - 特定区域是否包含内容

  **3.2.2 内容断言**
  - 元素文本等于/包含预期值
  - 输入框值验证
  - 列表项数量验证

  **3.2.3 状态断言**
  - 按钮启用/禁用状态
  - 复选框选中状态
  - 元素样式状态（颜色、显示/隐藏）

  **3.2.4 导航断言**
  - URL 包含/匹配预期路径
  - 页面标题验证

  **3.2.5 数据断言**
  - 表格数据验证
  - 列表排序验证
  - 数值范围验证

### 3.3 智能推荐引擎 (Smart Recommendation)

* **当** 用户完成一个操作步骤时，**系统** 必须 分析以下上下文生成断言推荐：
  - 操作类型（点击、输入、选择...）
  - 操作目标元素的语义（按钮文本、输入框标签）
  - 操作前后的页面变化
  - 历史相似操作的断言模式

* **系统** 应 为每个推荐断言提供：
  - 断言描述（自然语言）
  - 置信度分数
  - 推荐理由

* **系统** 应 按置信度排序展示推荐，最多展示 5 条。

### 3.4 断言编辑与确认 (Edit & Confirm)

* **当** 用户查看断言推荐时，**系统** 必须 提供以下操作：
  - 一键采用推荐断言
  - 修改断言参数（预期值、匹配方式）
  - 忽略该推荐
  - 手动添加自定义断言

* **系统** 应 支持自然语言输入自定义断言，AI 自动转换为可执行格式。

### 3.5 断言模板库 (Template Library)

* **系统** 应 维护断言模板库，包含：
  - 系统预置模板（登录成功、表单提交、购物车...）
  - 用户自定义模板
  - 团队共享模板

* **当** 用户确认采用某断言时，**系统** 应 询问是否保存为模板。

### 3.6 断言验证预览 (Validation Preview)

* **当** 用户选择一个断言推荐时，**系统** 必须 立即在当前页面执行验证并展示结果。
* **如果** 验证失败，**系统** 必须 提示用户检查断言条件或页面状态。

### 3.7 YAML 输出集成 (YAML Integration)

* **当** 断言被确认后，**系统** 必须 将断言转换为 Midscene YAML 格式：
  ```yaml
  - ai: "验证登录成功提示出现"
  - assert: "页面包含文本 '欢迎回来'"
  ```

* **系统** 必须 支持断言的批量管理（启用/禁用/删除）。

---

## 4. 非功能需求 (Non-Functional Requirements)

### 4.1 准确性 (Accuracy)

* **系统** 的断言推荐准确率目标应达到 75% 以上。
* **系统** 必须 避免推荐无意义或冗余的断言。

### 4.2 性能 (Performance)

* **系统** 必须 在操作完成后 3 秒内给出断言推荐。
* **系统** 的断言验证执行时间应 < 2 秒。

### 4.3 易用性 (Usability)

* **系统** 的断言推荐 UI 应简洁直观，不干扰主要测试流程。
* **系统** 应 支持快捷键快速采用或跳过断言推荐。

---

## 5. 限制与假设 (Constraints & Assumptions)

* **假设**: 用户对测试断言有基本概念，能理解验证的意义。
* **限制**: 复杂的业务逻辑验证（如计算结果正确性）需要用户手动定义。
* **限制**: 跨页面的数据一致性验证不在自动推荐范围内。
