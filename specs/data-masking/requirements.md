# 敏感数据脱敏 需求规格说明书

## 1. 引言

本功能旨在保护测试过程中涉及的敏感信息，防止密码、Token、个人隐私等数据在截图、日志、报告中泄露。通过自动检测和脱敏处理，确保测试数据的安全合规。

## 2. 术语定义

* **敏感数据 (Sensitive Data)**: 需要保护的信息，如密码、密钥、个人身份信息等。
* **脱敏 (Masking)**: 将敏感数据替换为不可识别形式的过程。
* **脱敏规则 (Masking Rule)**: 定义敏感数据识别和处理方式的规则。
* **白名单 (Whitelist)**: 明确不需要脱敏的数据列表。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 敏感数据识别 (Sensitive Data Detection)

* **系统** 必须 自动识别以下类型的敏感数据：

  **3.1.1 凭证类**
  - 密码字段（password, pwd, passwd）
  - API 密钥（api_key, apikey, api-key）
  - 访问令牌（token, access_token, bearer）
  - 密钥对（secret, private_key）

  **3.1.2 个人信息类**
  - 手机号码（中国、国际格式）
  - 身份证号
  - 邮箱地址
  - 银行卡号
  - 姓名（可配置）

  **3.1.3 业务数据类**
  - 信用卡号
  - 社保号
  - 驾照号
  - 护照号

* **系统** 应 支持自定义敏感数据模式（正则表达式）。

### 3.2 脱敏处理 (Masking Processing)

* **系统** 必须 在以下场景执行脱敏：
  - 截图保存前
  - 日志记录前
  - 报告生成时
  - 数据导出时

* **系统** 必须 支持以下脱敏方式：

  **3.2.1 完全遮盖**
  - 输入: `password123`
  - 输出: `***********`

  **3.2.2 部分保留**
  - 输入: `13812345678`
  - 输出: `138****5678`

  **3.2.3 哈希替换**
  - 输入: `admin@example.com`
  - 输出: `[EMAIL:a1b2c3]`

  **3.2.4 占位符替换**
  - 输入: `sk-abcd1234efgh5678`
  - 输出: `[API_KEY]`

### 3.3 截图脱敏 (Screenshot Masking)

* **当** 截图中包含输入框时，**系统** 必须 检测并遮盖敏感输入区域。
* **系统** 应 使用 OCR 识别截图中的敏感文本并模糊处理。
* **系统** 应 支持配置截图脱敏级别：
  - 关闭：不处理截图
  - 标准：遮盖已知敏感区域
  - 严格：OCR 全文检测

### 3.4 日志脱敏 (Log Masking)

* **系统** 必须 在日志输出前扫描并替换敏感内容。
* **系统** 应 保留脱敏前后的对应关系（可选，用于调试）。
* **系统** 应 支持按日志级别配置脱敏策略。

### 3.5 脚本脱敏 (Script Masking)

* **当** 测试脚本包含硬编码敏感数据时，**系统** 应 发出警告。
* **系统** 应 推荐使用环境变量或安全存储替代硬编码。
* **系统** 应 支持脚本中的敏感数据自动替换为变量引用。

### 3.6 规则管理 (Rule Management)

* **系统** 必须 提供内置脱敏规则库。
* **系统** 必须 支持用户自定义规则：
  - 规则名称和描述
  - 匹配模式（正则表达式）
  - 脱敏方式
  - 适用场景

* **系统** 应 支持规则优先级配置。
* **系统** 应 支持规则的启用/禁用。

### 3.7 白名单管理 (Whitelist Management)

* **系统** 应 支持配置不需要脱敏的数据白名单：
  - 测试环境的固定数据
  - 公开的示例数据
  - 特定格式的数据

### 3.8 审计日志 (Audit Log)

* **系统** 应 记录脱敏操作日志：
  - 脱敏时间
  - 脱敏类型
  - 数据来源
  - 操作用户

* **系统** 应 支持脱敏统计报告。

---

## 4. 非功能需求 (Non-Functional Requirements)

### 4.1 性能 (Performance)

* **系统** 的文本脱敏处理时间应 < 10ms / KB。
* **系统** 的截图脱敏处理时间应 < 500ms / 张。

### 4.2 准确性 (Accuracy)

* **系统** 的敏感数据识别准确率应 > 95%。
* **系统** 应 避免误报（将正常数据标记为敏感）。

### 4.3 安全性 (Security)

* **系统** 必须 确保脱敏过程本身不泄露敏感数据。
* **系统** 必须 在内存中安全处理敏感数据。

---

## 5. 限制与假设 (Constraints & Assumptions)

* **假设**: 用户愿意配置必要的脱敏规则。
* **限制**: OCR 识别可能存在误差，需要人工验证。
* **限制**: 高度定制的敏感数据格式需要手动添加规则。
