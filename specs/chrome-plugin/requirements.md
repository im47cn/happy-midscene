# AI 驱动 UI 自动化测试插件 (MVP) 需求规格说明书

## 1. 引言

本产品旨在解决测试人员编码能力弱、手工测试效率低及脚本维护成本高的问题 。系统基于 Midscene.js 实现多模态需求理解，通过 Chrome 插件形态提供从 Markdown 需求到 YAML 测试脚本的自动化生成与版本管理功能。

## 2. 术语定义

* **系统 (System)**: 指基于 Midscene 内核开发的 Chrome 浏览器插件。
* **用户 (User)**: 指使用该插件的前端测试人员或开发人员。
* **宿主页面 (Host Page)**: 指当前浏览器正在访问的、待测试的目标 Web 页面。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 配置与连接 (Configuration & Connection)

* **当** 用户首次打开插件设置页时，**系统** 必须 提供输入框以接收私有 GitLab Host URL 和用户个人访问令牌 (Private Access Token)。
* **当** 用户保存配置信息时，**系统** 必须 验证 GitLab API 的连通性，并将敏感信息（Token）加密存储于本地浏览器存储 (chrome.storage.local) 中，不得上传至任何第三方服务器。
* **当** 用户进入插件主界面时，**系统** 必须 根据配置的 URL 和 Token，自动检索并展示用户有权限访问的 GitLab 项目列表。

### 3.2 需求导入与解析 (Requirement Import & Parsing)

* 
**当** 用户粘贴 Markdown 格式的文本或上传 Markdown 文件时，**系统** 必须 识别文本中的标题（作为用例名称）和列表项（作为测试步骤）。


* **当** 解析完成时，**系统** 必须 将自然语言描述的步骤转换为待执行的任务队列，并在界面上可视化展示。
* 
**在** 包含参数化数据（如具体金额、特定文案）的 Markdown 文档中，**系统** 必须 自动提取这些数值作为潜在的变量参数 。



### 3.3 交互式脚本生成与调试 (Interactive Generation & Debugging)

* **当** 用户点击“开始运行/生成”按钮时，**系统** 必须 依次读取任务队列中的步骤，调用 Midscene.js 接口在当前宿主页面上执行对应的 UI 操作（如点击、输入、滚动）。
* **在** 脚本执行期间，**系统** 必须 在宿主页面上高亮显示 AI 当前定位到的 UI 元素，以实现可视化的执行反馈。
* 
**如果** AI 无法定位到符合描述的元素或执行失败，**系统** 必须 暂停执行流程，并允许用户通过“框选”或“修改自然语言指令”的方式进行人工修复（Human-in-the-loop）。


* **在** 启用“H5 移动端模式”的情况下，**系统** 必须 调整 Midscene 的视口识别逻辑，适配移动端网页的 DOM 结构和交互手势。

### 3.4 脚本构建与预览 (Script Construction)

* 
**当** 所有步骤在本地执行成功后，**系统** 必须 自动生成符合 Midscene 规范的 YAML 格式测试用例代码 。


* **系统** 必须 在 YAML 文件中包含关键元数据，包括：用例描述、操作步骤 (Action)、预期结果断言 (Assert)。
* **当** 用户在预览界面查看生成的脚本时，**系统** 必须 提供简单的文本编辑器以便用户进行最终的微调。

### 3.5 版本管理与交付 (Version Control & Delivery)

* **当** 用户在主界面选择目标项目后，**系统** 必须 动态加载该项目下的所有远程分支列表。
* **当** 用户输入一个新的分支名称（如 `feature/login-test`）并确认时，**系统** 必须 基于项目的默认分支（通常为 main/master）调用 GitLab API 创建该新分支。
* 
**当** 用户点击“提交 (Commit)”按钮时，**系统** 必须 将生成的 YAML 内容封装为 Commit 请求，直接推送至私有 GitLab 仓库的指定路径下 。


* **如果** 提交成功，**系统** 必须 返回新文件的 GitLab Web 链接供用户跳转查看。

---

## 4. 非功能需求 (Non-Functional Requirements)

### 4.1 安全性 (Security)

* **系统** 必须 确保 GitLab Private Token 仅用于与用户配置的 Host URL 通信，禁止向任何其他域名发送。
* **系统** 必须 在 manifest.json 中声明最小权限集，仅在用户主动触发时请求宿主页面的 DOM 访问权限。

### 4.2 易用性 (Usability)

* **当** 插件执行耗时操作（如调用 LLM 分析页面或网络请求 GitLab）时，**系统** 必须 展示明确的加载状态或进度条，避免用户误认为界面卡死。
* **系统** 必须 支持快捷键操作，以便用户在不离开键盘的情况下触发“执行下一步”或“暂停”。

### 4.3 兼容性 (Compatibility)

* **系统** 必须 兼容 Chrome 浏览器最新版本（Manifest V3 标准）。
* **系统** 必须 支持主流的 GitLab API 版本（v4 及以上）。

---

## 5. 限制与假设 (Constraints & Assumptions)

* **假设**: 用户的网络环境可以同时访问公网（用于 LLM 服务，如需）和公司内网（用于私有 GitLab）。
* **限制**: MVP 版本暂不支持并发生成脚本，脚本生成过程需占用当前浏览器标签页。
* **限制**: 复杂的图形验证码（Captcha）处理不在自动化生成范围内，需人工辅助通过。
