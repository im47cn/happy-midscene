# 可视化测试设计器 - 使用指南

## 概述

可视化测试设计器是一个基于流程图的自动化测试编辑器，通过拖拽节点和连接线来定义测试流程。支持导出为 YAML 格式，与 Midscene 测试框架完全兼容。

## 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  工具栏: 保存 | 导出 | 撤销 | 重做 | 缩放 | 执行              │
├─────────────┬───────────────────────────────────┬───────────┤
│             │                                   │           │
│   节点面板   │            画布区域               │  属性面板   │
│             │                                   │           │
│  - 动作节点  │     ┌─────┐    ┌─────┐          │  节点配置   │
│  - 验证节点  │     │开始 │──→│导航 │──→ ...    │  表单输入   │
│  - 控制节点  │     └─────┘    └─────┘          │           │
│  - 数据节点  │                                   │           │
│             │         小地图                     │           │
│             │                                   │           │
└─────────────┴───────────────────────────────────┴───────────┘
```

## 快速开始

### 1. 创建基本流程

1. 从左侧**节点面板**拖拽**开始节点**到画布
2. 拖拽**导航节点**，设置目标 URL
3. 拖拽**点击节点**，设置目标元素
4. 拖拽**验证节点**，添加断言
5. 拖拽**结束节点**
6. 依次连接节点形成流程

### 2. 配置节点

1. 点击选中节点
2. 右侧**属性面板**显示节点配置
3. 填写必要字段（标红星）
4. 可选字段使用默认值

### 3. 连接节点

1. 从源节点的**输出端口**拖拽
2. 连接到目标节点的**输入端口**
3. 条件节点有 True/False 两个输出端口
4. 循环节点有循环体和输出两个端口

### 4. 运行测试

1. 点击工具栏的**执行按钮**
2. 或使用快捷键 `Ctrl+E` 导出后运行
3. 节点会高亮显示执行状态
4. 右侧显示执行结果

## 常见操作

### 文件操作

| 操作 | 方法 |
|------|------|
| 新建流程 | 工具栏 → 新建 |
| 打开项目 | 工具栏 → 打开 |
| 保存流程 | `Ctrl+S` 或工具栏 |
| 导出 YAML | `Ctrl+E` 或工具栏 → 导出 |
| 导入 YAML | 工具栏 → 导入 |

### 节点操作

| 操作 | 方法 |
|------|------|
| 添加节点 | 从面板拖拽到画布 |
| 选择节点 | 点击节点，`Ctrl+A` 全选 |
| 移动节点 | 拖拽或方向键微调 |
| 复制节点 | `Ctrl+C` 复制，`Ctrl+V` 粘贴 |
| 删除节点 | `Delete` 或 `Backspace` |
| 编辑节点 | 点击节点后在属性面板编辑 |

### 画布操作

| 操作 | 方法 |
|------|------|
| 平移画布 | 鼠标拖拽空白区域或中键拖拽 |
| 缩放画布 | 鼠标滚轮或 `Ctrl++/-` |
| 适应视图 | `Ctrl+0` |
| 切换网格 | `Ctrl+G` |
| 切换小地图 | `Ctrl+M` |

### 编辑操作

| 操作 | 方法 |
|------|------|
| 撤销 | `Ctrl+Z` |
| 重做 | `Ctrl+Y` 或 `Ctrl+Shift+Z` |
| 清除选择 | `Escape` |

## 高级功能

### 元素选择器

在需要指定目标元素的节点（如点击、输入）中：

1. 点击**选择元素**按钮
2. 浏览器会打开目标页面
3. 鼠标悬停在元素上预览
4. 点击元素确认选择
5. 自动生成元素描述和选择器

### 变量管理

1. 打开**变量管理面板**
2. 添加测试变量（如用户名、URL）
3. 在节点配置中使用 `${variableName}` 引用
4. 运行时自动替换

### 模板系统

1. 设计通用流程片段
2. 右键 → **保存为模板**
3. 从模板面板快速复用
4. 支持模板参数化

### 流程验证

1. 保存时自动验证
2. 错误节点显示红色边框
3. 鼠标悬停查看错误信息
4. 验证规则：
   - 必须有开始节点
   - 所有连接有效
   - 必填字段已填写
   - 无循环引用

## 工作流建议

### 测试用例结构

```
开始
  ↓
导航（打开页面）
  ↓
[循环] 多个测试场景
  ↓
  ├→ 导航（子页面）
  ├→ 动作（交互操作）
  ├→ 验证（断言结果）
  └→ [条件] 分支处理
  ↓
结束
```

### 最佳实践

1. **命名规范**
   - 节点标签描述操作内容
   - 变量名使用驼峰命名
   - 流程名称体现测试目标

2. **组织流程**
   - 使用分组节点组织相关步骤
   - 添加注释节点说明复杂逻辑
   - 适当使用子流程复用

3. **错误处理**
   - 关键节点设置超时时间
   - 配置失败处理策略
   - 添加验证节点确认操作结果

4. **性能优化**
   - 避免不必要的等待节点
   - 使用并行节点执行独立操作
   - 循环设置合理次数限制

## 故障排查

### 常见问题

**Q: 节点连接不上？**
A: 检查端口类型匹配，输入端口只能连接输出端口。

**Q: 导出的 YAML 无法运行？**
A: 确保所有必填字段已填写，运行流程验证检查错误。

**Q: 元素选择器找不到元素？**
A: 确认浏览器扩展已启用，页面已完全加载。

**Q: 执行时节点一直等待？**
A: 检查超时设置，可能元素未找到或条件不满足。

### 错误类型

| 类型 | 说明 | 处理方法 |
|------|------|----------|
| 结构错误 | 流程缺少必要组件 | 添加缺少的节点 |
| 连接错误 | 边的源/目标不存在 | 删除无效连接 |
| 配置错误 | 节点配置不完整 | 填写必填字段 |
| 循环错误 | 检测到死循环 | 修改循环条件 |

## 更多帮助

- 查看 [节点参考](./02-node-reference.md) 了解所有节点类型
- 查看 [快捷键列表](./03-keyboard-shortcuts.md) 提高操作效率
